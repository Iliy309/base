Непрерывная интеграция – практика разработки, которая заключается в частой автоматизированной сборке приложения для быстрого выявления проблем. Обычно интеграция выполняется на коммиты в репозиторий. За этим следит либо специальный сервер, либо сервис непрерывной интеграции. Он загружает код, собирает его (если это нужно для текущего приложения) и запускает различные проверки. Что и как запускать – определяется программистом. В первую очередь это тесты и линтер (проверка оформления кода). Кроме них могут запускаться утилиты, анализирующие безопасность, актуальность зависимостей и многое другое.

![Сервер непрерывной интеграции GitHub Actions Travis](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjIwNTcyNmQzMmI4NjE3YTdiMmJhNDEzNGZkY2Y4YTk1LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=f8eb862550c40a1703154d6ff695969a4873f8814081398e7d5907e56a15d6f8)

На каждый коммит запускается сборка (build). Во время сборки собирается приложение, устанавливаются зависимости, прогоняются тесты и все остальные проверки. Сборка, завершившаяся без ошибок, считается успешной. Если сборка не проходит, то программист получает уведомление. Дальше он смотрит отчет и исправляет ошибки.

Для внедрения непрерывной интеграции есть два пути. Первый, поставить себе на сервер Jenkins или его аналог. Этот вариант требует много ручной работы (плюс поддержка сервера). Он подходит компаниям, в которых очень сложные приложения, или они не хотят допускать утечки кода наружу, или у них настолько много проектов, что свой сервер дешевле, чем стороннее решение. Второй путь – воспользоваться сервисом непрерывной интеграции. Таких сервисов десятки, если не сотни. Есть из чего выбрать. Как правило, большинство из них бесплатны для открытых проектов.


# GitHub Actions

GitHub Actions — бесплатная для публичных репозиториев система непрерывной интеграции. Хекслет использует Actions во всех своих закрытых и открытых проектах ([пример](https://github.com/hexlet-boilerplates/nodejs-package)). С помощью Github Actions можно делать много полезного:

-   Запустить проверку кода линтером и тестами
-   Выполнить деплой проекта
-   Опубликовать новую версию пакета
-   Подключить оповещения в мессенджер о событиях в репозитории (новые issue, PR)
-   и многое другое

В этом уроке мы разберемся в основных концепциях системы, а затем рассмотрим пример настройки, чтобы быстро начать работу с Actions в своем репозитории.

![Github Actions](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjhhNmU0MmQzNGZlZjRhMDY2MzBhMDNiNjAzNzdkNDBiLnBuZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=98ecd597384ccdd7bf034720e1501c2a9faacf3f65d3e5a68d9a54c97ceda6c9)

Общий принцип работы Github Actions такой: в нужном репозитории создается директория _.github/workflows_. Внутри нее размещаются файлы с описанием шагов, которые нужно выполнить на различные действия. Ниже описание процесса "hello-world", который запускается на пуш в репозиторий. В терминах Github Actions такое описание процесса называется воркфлоу. В нем определяется на какие события реагировать и что конкретно делать:

```
# file: .github/workflows/hello-world.yml
name: hello-world
# on – определяет события, которые запускают воркфлоу
on: push
jobs:
  # build – произвольно выбранное имя задания
  # их может быть больше одного
  build:
    # операционная система для работы воркфлоу
    runs-on: ubuntu-latest
    steps: # список шагов, которые надо выполнить
      # экшен, выполняет какую-то задачу
      # checkout – клонирует репозиторий
      - uses: actions/checkout@v3
      # run – произвольная bash-команда
      # ls -la выведет содержимое текущего репозитория
      - run: ls -la
```

Этот воркфлоу просто печатает на экран две строчки подряд. Реальные воркфлоу выглядят сложнее, но прямо сейчас нам важно ухватить общую структуру не отвлекаясь на конкретный процесс. У любой системы непрерывной интеграции есть набор блоков, из которых строится процесс выполнения. Он примерно одинаковый для всех за исключением некоторых деталей. Дальше мы кратко пробежимся по этим блокам, а уже в следующих уроках подробно поговорим про некоторые из них.

## Основные понятия

На картинке ниже показаны основные концепции GitHub Actions. Разберем их по порядку.

![Основные концепции Github Actions](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjE0ZmU0NWQyYzliMDY3MDYzZWU3M2MxNDE2YWZjY2Q0LnBuZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=1b93f6742fc92459b6dedbabab714c9de6d9189bb98a006f57e6a376144d6ab7)

-   Воркфлоу / Workflows
    
    Каждый репозиторий на GitHub может содержать один или несколько воркфлоу. Каждый воркфлоу определяется в отдельном файле конфигурации в каталоге репозитория _.github/workflows_. Несколько воркфлоу могут выполняться параллельно.
    
-   События / Events
    
    Воркфлоу может запускаться одним или несколькими событиями. Это могут быть внутренние события GitHub (например, пуш, релиз или пул-реквест), запланированные события (запускаются в определенное время — например, cron) или произвольные внешние события (запускаются вызовом Webhook API GitHub).
    
-   Задания / Jobs
    
    Воркфлоу состоит из одного или нескольких заданий. Задание содержит набор команд, которые запускаются вместе с рабочим процессом. По умолчанию при запуске воркфлоу все его задания выполняются параллельно, однако между ними можно определить зависимость, чтобы они выполнялись последовательно.
    
-   Раннеры / Runners
    
    Каждое задание выполняется на определенном раннере — временном сервере на GitHub с выбранной операционной системой (Linux, macOS или Windows). Также существуют [автономные раннеры](https://docs.github.com/en/actions/hosting-your-own-runners), которые позволяют создать свое окружение для выполнения экшена.
    
-   Шаги / Steps
    
    Задания состоят из последовательности шагов. Шаг — это либо команда оболочки (shell command), либо экшен (action). Все шаги задания выполняются последовательно на раннере, связанном с заданием. По умолчанию в случае сбоя шага все следующие шаги задания пропускаются.
    
-   Экшен / Actions
    
    Экшен — многократно используемый блок кода, который может служить шагом задания. Каждый экшен может принимать на вход параметры и создавать любые значения, которые затем можно использовать в других экшенах. Разработчики могут создавать собственные экшены или использовать опубликованные сообществом GitHub. Общих экшенов около тысячи, все они доступны на [GitHub Marketplace](https://github.com/marketplace?type=actions).