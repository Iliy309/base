#network

## Провайдеры

Чтобы подключиться к глобальной сети, недостаточно взять патч-корд ( к каммутатору) и присоединить его к компьютеру. Выйти в глобальную сеть можно через договор с поставщиками интернета — **провайдерами**.

Провайдеры делятся на три уровня, у каждого из которого своя зона ответственности:

-   **Tier-1** — провайдеры первого уровня. Главные поставщики интернета, так как владеют основными магистралями. Например, им принадлежат кабели, которые соединяют материки друг с другом. На 2021 год таких компаний насчитывается 16 в мире
    
-   **Tier-2** — провайдеры второго уровня. Национальные компании, которых в каждой стране свое количество. В России два таких провайдера, и для выхода в интернет они покупают доступ у провайдеров уровня Tier-1
    
-   **Tier-3** — провайдеры третьего уровня. Региональные провайдеры, которые работают в пределах района или города. Они покупают доступ у провайдеров уровня Tier-2. С ними заключают договор пользователи интернета
    

Например, сеть начнет давать сбои, если длина кабеля превысит 100-120 метров. После этих значений сигнал слабеет, и информация не доходит до получателя. У провайдеров есть оборудование и возможности организовывать сеть с минимальными потерями и максимальной скоростью даже через континенты.

### Стандарт IPv4

IP-адрес стандарта IPv4 состоит из четырех числовых блоков и записывается в формате десятичной [системы счисления](https://guides.hexlet.io/ru/numeral-systems/?roistat_visit=6483309) — используются цифры от нуля до девяти. Каждый блок IP-адреса содержит число от 0 до 255 — например, 172.32.110.14.

В этом стандарте выделяют два типа адресов:
-   Частные
-   Внешние
**Частные** адреса работают только в пределах локальной сети — по ним нельзя передать информацию из глобальной. В интернете насчитывается 22 085 632 таких адресов, они выделяются по группам:

-   10.0.0.0 — 10.255.255.255
-   100.64.0.0 — 100.127.255.255
-   172.16.0.0 — 172.31.255.255
-   192.168.0.0 — 192.168.255.255

Устройства в локальной сети получат адрес из частной группы адресов, а если устройство подключено к интернету, то оно получит **внешний** IP-адрес

### Стандарт IPv6

Размер адреса в стандарте IPv6 больше, чем в стандарте IPv4. Он состоит из восьми блоков и записывается в [шестнадцатеричной системе счисления](https://guides.hexlet.io/ru/numeral-systems/?roistat_visit=6483309) — цифры от нуля до девяти и буквы a, b, c, d, e, f. Например, a391:5008:1081:a567:b:863e:5543:b2cc. Таких адресов насчитывается 340 282 366 920 938 463 463 374 607 431 768 211 456 — более 340 ундециллионов.

С каждым днем количество компьютеров в сети увеличивается, поэтому IP-адресов стандарта IPv4 может не хватить. Стандарт IPv6 придумали, чтобы решить эту проблему. Но с увеличением числа адресов в ARPANet стали задумываться, как и где хранить столько адресов.

#### Как экономят IP-адреса
Провайдеры используют два способа экономии IP-адресов стандарта IPv4:

-   Динамические адреса
-   Серые IP
**Динамические адреса** можно переиспользовать. Например, когда устройство выходит из сети, то его адрес освобождается и передается другому пользователю.

При **серых IP** создается большая локальная сеть, например, для жилого дома. К глобальной сети подключается только один главный роутер, а к нему подключают сотни пользователей. В такой схеме внешний IP называется **белый IP**.

### Сетевая модель делится на 4 уровня, в каждом из которых применяются протоколы для работы той или иной функции:

1.  **Канальный уровень** или **Link Layer** — самый низкий уровень. На этом уровне описываются протоколы, которые обеспечивают связь компьютеров в сети, обработка данных устройствами. Проводное, спутниковое, беспроводное соединения, сетевые карты и свитчи — все это относится к канальному уровню
    
2.  **Сетевой уровень** или **Network Layer** — протоколы для взаимодействия сетей между собой. В модели TCP/IP на этом уровне используется протокол IP
    
3.  **Транспортный уровень** или **Transport Layer** — протоколы для передачи информации. В интернете на этом уровне используются протоколы TCP и UDP, которые мы рассмотрим в этом уроке
    
4.  **Прикладной уровень** или **Application Layer** — протоколы для связи сетевых приложений. Эти протоколы позволяют открывать сайты, смотреть онлайн-фильмы. Подробнее прикладной уровень разберем в следующих уроках

![[tcp -ip.png]]

Все протоколы зависят друг от друга. Нельзя использовать сетевой уровень, если отсутствует канальный. Например, между компьютерами нет подключения, но мы хотим дать им адреса. Поэтому модель называется стеком — все уровни наслаиваются друг на друга без возможности пропустить какой-то из уровней.

## Транспортный уровень

Транспортный протокол отвечает за транспортировку информации между компьютерами. Когда между устройствами передается большое количество информации, она разбивается на небольшие части — **пакеты**, которые посылаются поочередно. Компьютер собирает все пакеты вместе и проверяет их целостность по соглашениям, если это определено в протоколе.

Представьте коробки с вещами при переезде. Если вещей много, то их не поместить внутрь одной коробки, поэтому нужно больше коробок. Пакеты в интернете работают по такому же принципу. Например, видео невозможно передать в один прием из-за ограничений на канальном уровне. Поэтому информацию разбивают на несколько пакетов и передают их последовательно.

Размер информации, который можно передать в пакете, зависит от разных обстоятельств, ограничений, соглашений. Например, от способа подключения, ограничений провайдера и особенностей оборудования. В среднем это значение составляет 1500-2000 байт или 1.5-1.9 килобайта. Например, если нам нужно передать музыкальную композицию весом 5120 килобайт, то понадобится  пакетов.

Чтобы такое количество информации корректно передавалось, на транспортном уровне определяется:

-   Как нумеруются пакеты
-   Проверяется ли доставка пакетов
-   Проверяется ли целостность пакетов — не содержат ли отправленный и полученный пакеты различий
-   Сколько пакетов пришло и сколько еще ожидать

В интернете на транспортном уровне используются два основных протокола:

-   **TCP** (Transmission Control Protocol). Гарантирует доставку пакетов и контролирует ее. Информация передается только в том случае, если между компьютерами устанавливается связь и подтверждается готовность к передаче/приему
    
-   **UDP** (User Datagram Protocol). Пакеты пересылаются, но не проверяются. Информация пересылается быстрее, так как нет дополнительных проверок, но возможны потери


### Протокол TCP

Перед тем, как отправить пакеты по протоколу TCP, устанавливается связь между компьютерами. На языке системных администраторов такой процесс называется **рукопожатием** или **handshake**. Связь устанавливается в три этапа:

1.  Компьютер, который отправляет данные, посылает запрос на передачу информации
    
2.  В ответ ожидает пакет с подтверждением готовности к приему информации
    
3.  Компьютер отправляет запрос, что получил подтверждение
    

![Handshake в TCP](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6ImM2YmE4M2VkMGQwMjA4YjAwMGMwN2NmNTQ5MzU0ZDZhLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=149d897b73652785aafb7460c5d8e6606b7fb7e77fa1345fe6fdccb470d45add)

Это упрощенная схема, но в ней видно, что компьютер, который посылает информацию, не только отправляет запрос на передачу, но и подтверждает, что ему пришло разрешение. Такой способ ненадолго задерживает время до отправки информации, но гарантирует, что оба устройства могут обмениваться информацией.

Пакеты в TCP передаются с постоянным подтверждением. Каждый пакет отправляется и подтверждается по отдельности:

![Обмен пакетами в TCP](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6ImUyMjk2ZGFhODk2NDI5OGZkNzFiMTNiMzNjYmI3YmI1LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=a60128a687928839df141d9b4e1fd05835692637a89120aaa17b69b8365bf44e)

Если при передаче пакета произошла ошибка, например, оборвалась связь, и не было подтверждения, то пакет посылается еще раз. Для этого у каждого пакета есть таймер, в течение которого ожидается подтверждение:

![Ожидание подтверждения](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjI1ZmIwYWFkZDIzMDNhMThkNDcxNzQ5OTgyNTFlZDJlLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=a6200a42d3644f4636aa72955e01d728a7da4e298902745fe96b6968fd6bcddb)

Принимать подтверждение на каждый пакет требуется в условиях плохой связи или при передаче важной информации. Эта процедура не происходит мгновенно, и чем больше данных, тем больше времени уходит на подтверждение пакетов.

Чтобы не подтверждать получение каждого пакета, используется **скользящее окно** или **Sliding Window**. В этом случае подтверждается не один пакет, а сразу несколько. В остальном отличий нет — если пришло подтверждение, то посылаются следующие пакеты, если подтверждения нет, то повторяется пересылка пакетов.

![TCP. Скользящее окно](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjVmNjU4OGUzNWFlYmU5MDlmNzkwZDY4ZTNhNzg0Y2RkLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=4227a4e752d7047ce6a6f6fec4c5fecfadd2b4519f6c1d39e5b1eb853fb91570)

TCP обеспечивает надежность, но на это тратится время. Представьте, что вы играете в онлайн игру, где на счету каждая миллисекунда. В этом случае задержки могут все испортить. Чтобы быстро передавать информацию, используют протокол UDP, который не требует подтверждения получения пакета.

### Протокол UDP

UDP используют в ситуациях, когда нужно быстро отреагировать на полученную информацию. Например, запрос об IP-адресе, действия в игре, потоковая передача видео и аудио. При потоковой передаче не дожидается загрузка файла, а воспроизводится та часть, которая уже загрузилась.

От UDP требуется только отправить информацию. Будет она получена, повреждена или продублирована — не важно. Поэтому протокол используется для передачи небольшой информации.

![Протокол UDP](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6ImUwNTI5NjJjM2RkNmI3Yjk4ZWNiMWJlMjdmNjIyMDU1LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=7f5d9ac85b4a4a843668bebb6ec2154bd2c96351f557e36cc532825934301477)

Если пакет по какой-то причине не дошел, то его повторная отправка не произойдет. По этой причине UDP не используется для передачи важной или большой информации.

Представьте онлайн игру, где вашему персонажу нужно прыгать. Если передавать информацию по протоколу TCP, то возникнет задержка между нажатием клавиши и получением об этом информации в игре. Задержка небольшая, но в соревновательных играх она может привести к проигрышу. Информация о действии персонажа небольшая, поэтому ее можно послать при помощи протокола UDP.

Конечно, если информация не дойдет, то вообще не будет никакого действия. Но вероятность у этого достаточно маленькая, и разработчики намерено пренебрегают надежностью в угоду скорости.


## Клиент-серверная архитектура и ее компоненты

Приложениями и сайтами одновременно могут пользоваться сотни и даже миллионы человек. Все они обращаются к одному компьютеру, который должен уметь обрабатывать запросы и присылать ответы. Такой подход называется **клиент-серверной архитектурой**. Она описывает, как происходит работа с пользователями, где хранятся данные и как обеспечивается их защита.

В клиент-серверной архитектуре используется три компонента:
-   **Клиент** — программа, которую мы используем в интернете. Чаще всего это браузер, но может быть и другая отдельная программа
-   **Сервер** — компьютер, на котором хранится сайт или приложение. Когда мы заходим на сайт магазина, мы обращаемся к серверу, на котором находится сайт
-   **База данных** — программа, в которой хранятся все данные приложения. Для магазина это будет база клиентов, товаров и заказов

![Клиент-серверная архитектура](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6Ijc1ZmY2MWI5ZTQ3NGRjZGZmNTc5NGE1MzkxYjFkY2QxLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=ebc205844b7aee6b5c32da22498f423e3eb92a2dfc2d422653889da9b14157b5)

Разберем подробнее особенности каждого компонента клиент-серверной архитектуры и их взаимодействие друг с другом.

### Особенности клиента

Клиент — это всегда программа. Ее назначение — дать пользователю удобный способ взаимодействия с сервером.

С точки зрения сервера, выбрать товар — это послать запрос на специальном языке запросов, например SQL. Но для простого пользователя это сложно. Поэтому клиент дает удобный способ взаимодействия, чтобы не писать код своими руками.

В следующих уроках мы познакомимся с работой сайтов и узнаем, что зайти на сайт — это не просто ввести его адрес в браузер. За этим действием скрываются специальные запросы, ответы и их расшифровка. Для пользователя — это лишнее, и клиент в виде браузера делает эту работу за нас.

### Особенности сервера

Сервер — компьютер, такой же как у нас, только намного мощнее. Основная задача сервера — бесперебойная работа и возможность обрабатывать миллионы запросов от пользователей.

Сервер позволяет не дублировать приложения. Без них для заказа продуктов пришлось бы скачать весь сайт к себе на компьютер, выбрать товары, записать их и отправить на компьютер магазина. Так как сайт находится на сервере, то тысячи человек могут обращаться к одному серверу и получать от него нужную информацию.

Если сервер выполняет функции приложения и базы данных, то такая архитектура называется **двухуровневой**. Такой подход используют для небольших приложений, где нет большого количества клиентов. Хоть такой способ и проще, но его надежность небольшая. Если сервер взломают, то злоумышленники получат все данные.

Чтобы решить проблему безопасности в клиент-серверной архитектуре, используют базу данных. Она хранится отдельно от сервера. Сервер в этом случае выполняет роль логической машины, которая обрабатывает данные, но не хранит их.

### Особенности базы данных

В клиент-серверной архитектуре сервер — это не только компьютер, на котором находится приложение или сайт. Еще это база, где хранятся все данные приложения. У клиентов нет прямого доступа к базе данных, так как это нарушило бы их приватность. Например, частность личной информации других пользователей в социальных сетях.

Клиенты запрашивают информацию у сервера. Если сервер считает, что у клиента есть права на получение информации, то он ее предоставляет. Благодаря этому мы не можем пользоваться учетными записями своих друзей в социальных сетях или получать информацию о банковских переводах незнакомых нам людей.

![Взаимодействие сервера и БД](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6ImZjMGI5MDI2MDJmMGI2YzIwYmRiYWY4OGQ2YjQwNWM5LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=b8c51d14088e08407acca25b7d4383dabb3c5b4f65bf00c4c7ba149f68565ce4)

При такой схеме работы архитектура называется **трехуровневой**, так как состоит из трех компонентов.

## Плюсы и минусы клиент-серверной архитектуры

В большинстве случаев минусы клиент-серверной архитектуры связаны с работоспособностью сервера или базы данных. Разработчики умеют решать большинство минусов, но не все так просто. Решение одних минусов приводит к другим, чаще всего к росту стоимости разработки и поддержки.

### Плюсы

-   Отсутствие дублирования. Весь сайт или приложение хранится на одном компьютере-сервере. Это позволяет использовать его с разных устройств, будь то компьютер или мобильный телефон
    
-   Минимальные требования к пользователю. От него требуется только наличие программы-клиента. Для работы с сайтами достаточно иметь браузер
    
-   Безопасность. Данные хранятся в базе данных и пользователи не могут их просматривать. Это обеспечивает безопасность для персональных данных
    
-   Производительность. Серверы обычно производительнее, чем компьютеры пользователей. Это позволяет обрабатывать тысячи запросов от сотни разных пользователей одновременно. Например, этот урок на Хекслете может читать одновременно сотня человек и вы этого не заметите


### Минусы

-   Перегрузка сервера. Популярные порталы могут получать большое количество запросов одновременно. Например, при десятке миллионов запросов в секунду сервер может не выдержать и отключиться. Этим пользуются хакеры при использовании DDoS-атаки. Подробнее виды атак рассмотрим в следующих уроках
    
-   Выход из строя сервера или базы данных. Это сделает сервис недоступным для всех пользователей
    
-   Высокая стоимость оборудования. Сервер похож на простой компьютер, но его комплектующие должны быть рассчитаны на бесперебойную работу 24/7. Такая надежность обеспечивается компонентами со специальными функциями, из-за чего стоимость оборудования повышается
    
-   Затраты на поддержку. Обычно недостаточно просто получить сервер и забыть про его существование. Должен быть специалист, который будет обслуживать сервер и быстро реагировать в случае поломок
    

Чтобы избавиться от большинства перечисленных минусов, разработчики используют кластеры серверов.

## Кластеры серверов и балансировщики

Чтобы избежать проблем с клиент-серверной архитектурой, разработчики применяют **кластеры серверов** — когда приложение находится не на одном, а сразу на нескольких серверах. Информация на таких серверах дублируется:

![Кластер серверов](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6Ijc4NjE1MWI2ZjFhZjg3ZGNkMzZhMjc4Mjk5ODFlMGFlLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=3fe2a4fd216bff571b8df1562dc13fe988b2151c27638d2f5bdf271b8e22f199)

Если один сервер вышел из строя, то его подменяет другой. Это дает время, чтобы устранить неисправности сервера так, что пользователи и не заметят.

Еще кластеры используются, чтобы распределять нагрузку. Мы уже говорили, что сервер может отключиться от десятка миллионов одновременных запросов. Кластеры можно настроить так, чтобы при десяти миллионах запросов они ушли не на один сервер, а на разные.

Чтобы определить, на какой сервер послать запрос, используются **балансировщик** — сервис, который пропускает все запросы через себя и следит, чтобы сервера не перегружались:

![Балансировщик](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6ImE2ZDQ3MzZmMGVlNWJhZDlmZTU0ZmUyYzQxNzRmMzg5LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=a8cc8509a743f1d0609bec22f6b3a78c165ea9a32b1935cb9ca49ef58cefef30)

Балансировщики и кластеры могут использоваться не только для серверов с приложением, но и для баз данных. Так можно получить независимые кластеры всего приложения, которые смогут подменять друг друга и помогать в обработке запросов от пользователей.

Такие решения повышают надежность приложения, но сильно возрастает стоимость оборудования и поддержки. Поэтому небольшие компании и частные сайты не используют их. В этом случае ответственность за работоспособность берут хостинги — компании, которые предоставляют услугу аренды серверов для приложений. Подробнее о них поговорим в следующих уроках.

### VPN

Можно шифровать информацию, использовать непопулярные сервисы или использовать одноразовую почту. Можно придумать разные способы, но все они имеют недостаток — данные находятся в интернете и их можно перехватить.

Чтобы решить такую проблему, была придумана технология VPN или частной виртуальной сети. При этом всё настраивается так, что на рабочие серверы можно попасть только через виртуальную сеть.

Сам по себе VPN — это сервер, к которому пользователи подключаются в частную сеть. Из этой сети и происходят запросы в интернет или ко внутренним ресурсам сети. Так как подключение к интернету происходит не от клиента, а от VPN сервера, то VPN используют для обхода блокировок сайтов или приложений в интернете:

![Выход в интернет с VPN](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6ImFiY2I5NDZhNzUxYzNhNTg2ZmZmMjZmNzg2ODIzYjkyLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=ed35750ccb02f811f96df84f7afbdd45748ffaebba1952a96713312710dcd23c)

Безопасность всей системы обеспечивается шифрованием еще до перехода данных к провайдеру. Значит, нет мест, где можно перехватить передаваемую информацию. Чтобы увидеть это, проиллюстрируем процесс подключения без VPN и с ним:

![Выход в интернет без VPN](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6ImIwZjFjMzczN2IwZDZjNzAzNmEwZDBjYWVlYTIyZTU2LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=029850413b59204c2ede4de4d327a9619e82c4743d1cbe42520886d201ab484a)

![Выход в интернет с VPN](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjcwNzYyNjEwZTExYzIwYzA2Njc0MWFlYzMzY2U3MTY5LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=7a49a990bc476595f7f653e38248d94f18d78fc22007b2754f074276ea89ab61)

При использовании VPN конечный сервер, на который передаются данные, не видит ни наш IP-адресс, ни нашу геолокацию. Теперь понятно, что обозначают слова в аббревиатуре VPN:

-   Virtual — виртуальная. На базе сервера VPN возможно объединить несколько компьютеров в единую сеть, как если бы создавалась обычная локальная сеть. Разница в способе подключения — компьютеры могут быть подключены откуда угодно и не требуется физически их объединять. Поэтому сеть и называется виртуальной
    
-   Private — приватная. В созданную виртуальную сеть нельзя зайти без доступа, эта сеть невидна и из интернета. Поэтому сеть и называется приватной или частной
    
-   Network — сеть. VPN объединяет компьютеры в единую систему, поэтому это сеть

#### Плюсы VPN

-   Шифрование данных еще до момента передачи информации до провайдера
    
-   Возможность использовать частные сети при удаленной работе
    
-   VPN позволяет подключаться с любого устройства и из любой точки мира
    
-   VPN обеспечивает достаточную приватность в интернете

#### Минусы VPN

-   Дополнительный сервер может замедлять скорость подключения. Минимальная скорость заметна при использовании бесплатных VPN серверов
    
-   Неправильно настроенный сервер VPN может позволить мошенникам узнать наш IP-адрес
    
-   Хорошие VPN сервера стоят дорого

### Прокси-сервер

**Прокси-сервер** — сервер, который является промежуточным звеном между пользователем и интернетом. Как и при использовании VPN, клиент посылает данные не напрямую на конечный сервер, а через посредника.

Этот способ позволяет скрыть наш настоящий IP-адрес от конечного сервера и обойти многие блокировки провайдера:

![Использование прокси-сервера](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6ImEwZDVlYTljZWQyYzMzNTc3YTM2NGU2N2M1YzZlYTk2LmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=b104b749d355d0dea8f6504a8eaec726a81cc6c085f047d63309a45e8e378640)

Схема использования прокси-сервера немного похожа на использование VPN. Разница в том, что прокси — это просто еще один сервер, который помогает скрыть наш настоящий IP-адрес, но он не обеспечивает безопасность передаваемых данных.

При использовании VPN данные могут шифроваться на нашем компьютере и только после этого посылаться далее. При использовании прокси данные проходят без дополнительного шифрования, что оставляет возможность для их перехвата.

Существует два основных типа прокси-серверов:

-   **Прозрачные**. Самый честный вид прокси-серверов, который посылает на конечный сервер информацию о том, кто настоящий отправитель данных. Такой тип серверов используются в государственных и учебных заведениях, чтобы дополнительно заблокировать нежелательный контент в учреждении
    
-   **Анонимные**. Когда говорят о прокси, то чаще всего имеют в виду именно такой тип подключения. Анонимные прокси не раскрывают себя и клиента, который посылает информацию. Для сервера все выглядит так, что прокси-сервер и есть клиент

Анонимные прокси-сервера делятся еще на несколько групп в зависимости от того, как часто там меняются IP-адреса и какие дополнительные механизмы приватности используют.

У прокси-сервера тоже есть свои плюсы и минусы:

#### Плюсы прокси-сервера

-   Скрытие настоящего IP-адреса
    
-   Обход ограничений провайдера

#### Минусы прокси-сервера

-   Низкая скорость соединения при использовании бесплатных прокси-серверов
    
-   Возможна выдача «плохих» IP-адресов, которые забанены на различных ресурсах из-за нарушений правил

### Tor

Самый параноидальный способ приватности в интернете — использование **Tor**, что расшифровывается как The Onion Router или луковая маршрутизация.

Разберем, причем здесь лук и как Tor обеспечивает анонимность в интернете. Еще узнаем, почему из-за Tor возник теневой интернет или **Darknet**.

Основа луковой маршрутизации — использование нескольких прокси-серверов между клиентом и конечным сервером. Таких прокси-серверов три и сообщение шифруется трижды. В итоге каждый прокси-сервер может расшифровать только одну часть, в которой указано, куда пересылать сообщение дальше:

![Тройная маршрутизация в Tor](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjM1ZmMyYmJkNTI5NTM0OGIyY2EwMjA2YmU1YWMzYjhiLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=65b1d3e8d143f029924ad02c9664596a535ef38b83672e53c8c53b77d1a94747)

У каждого из прокси-серверов есть свое имя:

-   **Входной прокси-сервер** — первый прокси, на который посылается информация. Он может расшифровать данные, в которых указан путь до промежуточного прокси-сервера. У сервера нет выхода в интернет
    
-   **Промежуточный прокси-сервер** — как и входной этот прокси-сервер не имеет выхода в интернет и может передавать данные только внутри сети Tor. Сервер расшифровывает данные о расположении выходного прокси-сервера
    
-   **Выходной прокси-сервер** — сервер, у которого есть выход в интернет. Адрес выходного узла будет известен конечному серверу, но из-за других прокси-серверов адрес пользователя остается неизвестным
    

Из-за того, что каждый прокси-сервер понемногу расшифровывает данные, технология называется луковым шифрованием. Процесс похож на постепенное снятие слоев с лука:

![Тройное шифрование данных в Tor](https://cdn2.hexlet.io/derivations/image/original/eyJpZCI6IjExY2ZlNGYyZjFlMTI2ZTZkMjM4ZDVjZDMxZGFhYmIzLmpwZyIsInN0b3JhZ2UiOiJjYWNoZSJ9?signature=267e2ab117971666d98dd5cb382d3e1c2fc26e189c3aae782b0f380906bd55b0)

Внутри Tor сформировалась своя глобальная сеть, в которую нельзя попасть из интернета. Так как данные множественно шифруются, то отследить отправителя сообщения крайне трудно. Этим начали пользоваться мошенники, торговцы запрещенными предметами и все те, кто хочет скрыть свои цифровые следы. Так появился **DarkNet** — темный интернет.

#### Плюсы Tor

-   Скрытие клиентского IP-адреса
    
-   Множественное шифрование данных
    
-   Наличие сети Tor, у которой нет выхода в интернет
    

#### Минусы Tor

-   Медленная работа из-за трех прокси-серверов и расшифровки на каждом из них
    
-   Провайдер может отследить, что вы используете Tor
    
-   Выходные прокси-серверы известны и могут быть заблокированы конечным сервером